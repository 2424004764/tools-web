var e=(e,l,t)=>new Promise((s,a)=>{var i=e=>{try{r(t.next(e))}catch(l){a(l)}},n=e=>{try{r(t.throw(e))}catch(l){a(l)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,n);r((t=t.apply(e,l)).next())});import{f as l,_ as t}from"../assets/index-139225df.js";import{d as s,t as a,q as i,r as n,U as r,al as o,o as c,c as u,R as d,a as m,K as x,ae as p,aj as g,P as v,O as b,Q as f,a4 as y,M as h,D as w,u as k,J as P}from"./chunk-bb5ca2a1.js";import{_}from"./chunk-af583744.js";import{_ as j}from"./chunk-9c6aa90d.js";import"./chunk-0a8d181f.js";import"./chunk-96adf8d3.js";import"./chunk-b045bb46.js";const z={class:"flex flex-col mt-3 flex-1"},M={class:"p-4 rounded-2xl bg-white"},E={class:"mb-6"},C={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},F={class:"flex items-center col-span-full"},W={class:"flex items-center space-x-2"},$={class:"text-sm text-gray-600 w-12"},U={class:"space-y-2"},I={class:"flex justify-between text-xs text-gray-500"},R={class:"text-xs text-gray-600"},S={class:"flex items-center"},G={class:"flex items-center"},L={key:0,class:"mb-6 p-4 bg-gray-100 rounded-lg"},B={class:"text-xs text-gray-600 max-h-32 overflow-y-auto"},D={class:"mb-6"},T={key:1,class:"mb-6"},q={class:"flex justify-between items-center mb-4"},O={class:"text-lg font-semibold"},V=["disabled"],X={key:0},J={key:1,class:"flex items-center"},N={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Q={class:"flex items-center justify-between mb-2"},K={class:"text-sm font-medium text-gray-700 truncate"},A=["onClick"],H={class:"text-xs text-gray-500 mb-2"},Y={class:"text-xs text-gray-500 mb-2"},Z={class:"text-xs text-blue-600 bg-blue-50 p-2 rounded"},ee={key:2,class:"mb-6"},le={class:"flex justify-between items-center mb-4"},te={class:"text-lg font-semibold"},se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ae={class:"mb-3"},ie=["src","alt"],ne={class:"space-y-2 text-sm"},re={class:"flex justify-between"},oe={class:"font-medium"},ce={class:"flex justify-between"},ue={class:"font-medium"},de={class:"flex justify-between"},me={class:"font-medium text-green-600"},xe={key:0,class:"text-xs text-gray-500 border-t pt-2 mt-2"},pe=["onClick"],ge=t(s({__name:"ImageCompress",setup(t){let s=null;const ge=()=>e(this,null,function*(){try{const e=yield l(()=>import("./chunk-e73656b4.js").then(e=>e.c),["js/chunk-e73656b4.js","js/chunk-0a8d181f.js","js/chunk-bb5ca2a1.js"]);s=e.default||e}catch(e){alert("图片压缩库加载失败，请刷新页面重试")}});a(()=>{ge()});const ve=i({quality:.6,convertSize:1e6,convertToWebP:!1,retainExif:!1,smartCompression:!0}),be=n(!1),fe=n(!1),ye=n([]),he=n([]),we=n([]),ke=e=>{if(!e)return;const l=Array.from(e).filter(e=>e.type.startsWith("image/"));0!==l.length?(ye.value=[...ye.value,...l],ze(`添加了 ${l.length} 张图片`)):alert("请选择图片文件")},Pe=e=>{var l;e.preventDefault(),be.value=!1;const t=null==(l=e.dataTransfer)?void 0:l.files;t&&ke(t)},_e=e=>{e.preventDefault(),be.value=!0},je=e=>{e.preventDefault(),be.value=!1},ze=e=>{const l=(new Date).toLocaleTimeString();we.value.push(`[${l}] ${e}`)},Me=()=>e(this,null,function*(){if(0!==ye.value.length)if(s){fe.value=!0,he.value=[],ze("开始压缩图片...");try{for(const e of ye.value)yield Ee(e)}catch(e){ze(`压缩失败: ${e}`),alert("压缩过程中出现错误，请重试")}finally{fe.value=!1,ze("压缩完成")}}else alert("图片压缩库未加载，请刷新页面重试")}),Ee=e=>new Promise((l,t)=>{ze(`开始压缩: ${e.name} (${Ue(e.size)})`);const a=new Image;a.onload=()=>{ze(`原图尺寸: ${a.width}×${a.height}`);let i=ve.quality;if(ve.smartCompression){const l=e.size/1048576;l>5?i=Math.min(i,.5):l>2&&(i=Math.min(i,.6)),ze(`调整后质量: ${Math.round(100*i)}%`)}ze(`压缩参数: 质量=${Math.round(100*i)}%, 保持原尺寸`),new s(e,{quality:i,convertSize:ve.convertSize,convertToWebP:ve.convertToWebP,retainExif:ve.retainExif,success:t=>{const s=(e.size-t.size)/e.size*100;ze(`压缩完成: ${e.name} -> ${Ue(t.size)} (压缩率: ${s.toFixed(1)}%)`);const n={id:Date.now().toString()+Math.random(),originalFile:e,compressedFile:t,originalSize:e.size,compressedSize:t.size,compressionRatio:s,url:URL.createObjectURL(t),actualQuality:i,actualMaxWidth:a.width,actualMaxHeight:a.height};he.value.push(n),l()},error:l=>{ze(`压缩失败: ${e.name} - ${l.message||l}`),t(l)}})},a.onerror=()=>{ze(`无法读取图片: ${e.name}`),t(new Error("无法读取图片"))},a.src=URL.createObjectURL(e)}),Ce=i({title:"图片压缩"}),Fe=e=>{const l=document.createElement("a");l.href=e.url,l.download=`compressed_${e.originalFile.name}`,document.body.appendChild(l),l.click(),document.body.removeChild(l)},We=()=>{he.value.forEach(e=>{Fe(e)})},$e=()=>{ye.value=[],he.value.forEach(e=>{URL.revokeObjectURL(e.url)}),he.value=[],we.value=[]},Ue=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},Ie=e=>{const l=e.size/1048576;return l>5?"建议：大文件推荐质量0.5以下，最大尺寸1200×800":l>2?"建议：中等文件推荐质量0.6以下，最大尺寸1200×800":l>1?"建议：小文件推荐质量0.7以下，最大尺寸1200×800":"建议：小文件可以保持较高质量，但建议关闭EXIF保留"};return r(()=>{he.value.forEach(e=>{URL.revokeObjectURL(e.url)})}),(e,l)=>{const t=o("el-text");return c(),u("div",z,[d(_,{title:Ce.title},null,8,["title"]),m("div",M,[m("div",E,[l[14]||(l[14]=m("h3",{class:"text-lg font-semibold mb-4"},"压缩设置",-1)),m("div",C,[m("div",F,[x(m("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>ve.smartCompression=e),type:"checkbox",id:"smartCompression",class:"mr-2"},null,512),[[p,ve.smartCompression]]),l[6]||(l[6]=m("label",{for:"smartCompression",class:"text-sm font-medium text-gray-700"}," 智能压缩（根据文件大小自动优化质量参数） ",-1))]),m("div",null,[l[7]||(l[7]=m("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"压缩质量",-1)),m("div",W,[x(m("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>ve.quality=e),type:"range",min:"0.1",max:"1",step:"0.1",class:"flex-1"},null,512),[[g,ve.quality]]),m("span",$,v(Math.round(100*ve.quality))+"%",1)]),l[8]||(l[8]=m("p",{class:"text-xs text-gray-600 mt-1"}," 图片将保持原始尺寸，仅调整压缩质量 ",-1))]),m("div",null,[l[11]||(l[11]=m("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" 转换阈值 "),m("span",{class:"text-xs text-gray-500 ml-1"},"(超过此大小的图片自动转换为WebP格式)")],-1)),m("div",U,[x(m("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>ve.convertSize=e),type:"range",min:"100000",max:"10000000",step:"100000",class:"w-full"},null,512),[[g,ve.convertSize]]),m("div",I,[l[9]||(l[9]=m("span",null,"100KB",-1)),m("span",null,v(Ue(ve.convertSize)),1),l[10]||(l[10]=m("span",null,"10MB",-1))]),m("p",R," 当前设置：当图片超过 "+v(Ue(ve.convertSize))+" 时，自动转换为WebP格式以获得更好的压缩效果 ",1)])]),m("div",S,[x(m("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>ve.convertToWebP=e),type:"checkbox",id:"convertToWebP",class:"mr-2"},null,512),[[p,ve.convertToWebP]]),l[12]||(l[12]=m("label",{for:"convertToWebP",class:"text-sm font-medium text-gray-700"},"转换为WebP格式",-1))]),m("div",G,[x(m("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>ve.retainExif=e),type:"checkbox",id:"retainExif",class:"mr-2"},null,512),[[p,ve.retainExif]]),l[13]||(l[13]=m("label",{for:"retainExif",class:"text-sm font-medium text-gray-700"},"保留EXIF信息",-1))])])]),we.value.length>0?(c(),u("div",L,[l[15]||(l[15]=m("h4",{class:"font-medium mb-2"},"调试信息:",-1)),m("div",B,[(c(!0),u(f,null,y(we.value,(e,l)=>(c(),u("div",{key:l,class:"mb-1"},v(e),1))),128))])])):h("",!0),m("div",D,[m("div",{onDrop:Pe,onDragover:_e,onDragleave:je,class:w(["border-2 border-dashed rounded-lg p-8 text-center transition-colors",be.value?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[l[16]||(l[16]=m("div",{class:"text-4xl mb-4"},"️",-1)),l[17]||(l[17]=m("p",{class:"text-lg font-medium text-gray-700 mb-2"},"拖拽图片到此处或点击选择",-1)),l[18]||(l[18]=m("p",{class:"text-sm text-gray-500 mb-4"},"支持 JPG、PNG、WebP、GIF 等格式",-1)),m("input",{type:"file",multiple:"",accept:"image/*",onChange:l[5]||(l[5]=e=>ke(e.target.files)),class:"hidden",id:"fileInput"},null,32),l[19]||(l[19]=m("label",{for:"fileInput",class:"inline-block px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 cursor-pointer transition-colors"}," 选择图片 ",-1))],34)]),ye.value.length>0?(c(),u("div",T,[m("div",q,[m("h3",O,"待压缩图片 ("+v(ye.value.length)+")",1),m("button",{onClick:Me,disabled:fe.value||!k(s),class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[fe.value?(c(),u("span",J,l[20]||(l[20]=[m("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),b(" 压缩中... ",-1)]))):(c(),u("span",X,"开始压缩"))],8,V)]),m("div",N,[(c(!0),u(f,null,y(ye.value,(e,l)=>(c(),u("div",{key:l,class:"border rounded-lg p-4 relative"},[m("div",Q,[m("span",K,v(e.name),1),m("button",{onClick:e=>(e=>{const l=ye.value[e];ye.value.splice(e,1);const t=he.value.findIndex(e=>e.originalFile===l);if(-1!==t){const e=he.value[t];URL.revokeObjectURL(e.url),he.value.splice(t,1)}})(l),class:"text-red-500 hover:text-red-700 text-lg"}," × ",8,A)]),m("div",H,v(Ue(e.size)),1),m("div",Y,v(e.type),1),m("div",Z,v(Ie(e)),1)]))),128))])])):h("",!0),he.value.length>0?(c(),u("div",ee,[m("div",le,[m("h3",te,"压缩结果 ("+v(he.value.length)+")",1),m("button",{onClick:We,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"}," 批量下载 ")]),m("div",se,[(c(!0),u(f,null,y(he.value,e=>(c(),u("div",{key:e.id,class:"border rounded-lg p-4"},[m("div",ae,[m("img",{src:e.url,alt:e.originalFile.name,class:"w-full h-32 object-cover rounded border"},null,8,ie)]),m("div",ne,[m("div",re,[l[21]||(l[21]=m("span",{class:"text-gray-600"},"原始大小:",-1)),m("span",oe,v(Ue(e.originalSize)),1)]),m("div",ce,[l[22]||(l[22]=m("span",{class:"text-gray-600"},"压缩后:",-1)),m("span",ue,v(Ue(e.compressedSize)),1)]),m("div",de,[l[23]||(l[23]=m("span",{class:"text-gray-600"},"压缩率:",-1)),m("span",me,v(e.compressionRatio.toFixed(1))+"%",1)])]),e.actualQuality?(c(),u("div",xe,[m("div",null,"实际质量: "+v(Math.round(100*e.actualQuality))+"%",1),m("div",null,"图片尺寸: "+v(e.actualMaxWidth)+"×"+v(e.actualMaxHeight),1)])):h("",!0),m("button",{onClick:l=>Fe(e),class:"w-full mt-3 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"}," 下载 ",8,pe)]))),128))])])):h("",!0),m("div",{class:"flex justify-end space-x-3"},[m("button",{onClick:$e,class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"}," 清空所有 ")])]),d(j,{title:"描述"},{default:P(()=>[d(t,null,{default:P(()=>l[24]||(l[24]=[b(" 图片压缩工具使用先进的Compressor.js库，支持多种图片格式的在线压缩。 可以调节压缩质量、最大尺寸等参数，在保持图片质量的同时有效减小文件大小。 支持批量处理，适合网站优化、邮件发送等场景。 ",-1)])),_:1,__:[24]})]),_:1}),d(j,{title:"功能特点"},{default:P(()=>l[25]||(l[25]=[m("ul",{class:"list-disc list-inside space-y-2 text-gray-700"},[m("li",null,"支持多种格式：JPG、PNG、WebP、GIF等"),m("li",null,"可调节压缩质量：0.1-1.0，平衡文件大小和质量"),m("li",null,"智能转换：大文件自动转换为WebP格式"),m("li",null,"保留EXIF：可选择保留图片的元数据信息"),m("li",null,"批量处理：支持多张图片同时压缩"),m("li",null,"实时预览：压缩前后对比，显示压缩率"),m("li",null,"拖拽上传：支持拖拽文件到页面"),m("li",null,"保持原尺寸：图片压缩后保持原始宽度和高度")],-1)])),_:1,__:[25]}),d(j,{title:"使用说明"},{default:P(()=>l[26]||(l[26]=[m("ol",{class:"list-decimal list-inside space-y-2 text-gray-700"},[m("li",null,"调整压缩参数：设置质量、尺寸等参数"),m("li",null,"上传图片：拖拽或点击选择图片文件"),m("li",null,'开始压缩：点击"开始压缩"按钮'),m("li",null,"查看结果：对比压缩前后的文件大小和压缩率"),m("li",null,"下载图片：单张下载或批量下载压缩后的图片")],-1)])),_:1,__:[26]}),d(j,{title:"为什么有的图片越压缩越大？"},{default:P(()=>l[27]||(l[27]=[m("div",{class:"space-y-3 text-gray-700"},[m("p",{class:"text-sm leading-relaxed"}," 图片压缩后文件变大是一个常见现象，主要原因如下： "),m("div",{class:"space-y-2"},[m("h4",{class:"font-medium text-gray-800"},"1. 压缩质量设置过高"),m("p",{class:"text-sm text-gray-600 pl-4"}," 如果压缩质量设置为1.0（100%），实际上没有进行任何压缩，反而可能因为格式转换导致文件变大。 "),m("h4",{class:"font-medium text-gray-800"},"2. 尺寸限制设置不当"),m("p",{class:"text-sm text-gray-600 pl-4"}," 如果设置的最大宽度/高度比原图尺寸还大，图片不会被缩小，反而可能因为重新编码而增大。 "),m("h4",{class:"font-medium text-gray-800"},"3. 格式转换问题"),m("p",{class:"text-sm text-gray-600 pl-4"}," 某些格式转换（如PNG转JPG）可能会增加文件大小，特别是当原图包含大量透明区域或简单图形时。 "),m("h4",{class:"font-medium text-gray-800"},"4. EXIF信息保留"),m("p",{class:"text-sm text-gray-600 pl-4"}," 保留EXIF信息（相机参数、GPS位置等）会增加文件大小，建议关闭此选项以获得更好的压缩效果。 "),m("h4",{class:"font-medium text-gray-800"},"5. 原图已经高度压缩"),m("p",{class:"text-sm text-gray-600 pl-4"}," 如果原图已经是高度压缩的格式（如低质量JPG），再次压缩可能无法获得更好的效果。 ")]),m("div",{class:"bg-blue-50 p-3 rounded-lg"},[m("h4",{class:"font-medium text-blue-800 mb-2"},"💡 压缩建议"),m("ul",{class:"text-sm text-blue-700 space-y-1"},[m("li",null,"• 大文件（>5MB）：质量0.5以下，最大尺寸1200×800"),m("li",null,"• 中等文件（2-5MB）：质量0.6以下，最大尺寸1200×800"),m("li",null,"• 小文件（<2MB）：质量0.7以下，关闭EXIF保留"),m("li",null,'• 开启"智能压缩"选项，让工具自动优化参数'),m("li",null,"• 对于PNG图片，考虑转换为WebP格式以获得更好的压缩效果")])]),m("div",{class:"bg-yellow-50 p-3 rounded-lg"},[m("h4",{class:"font-medium text-yellow-800 mb-2"},"⚠️ 注意事项"),m("ul",{class:"text-sm text-yellow-700 space-y-1"},[m("li",null,"• 压缩质量越低，文件越小，但图片质量也越差"),m("li",null,"• 尺寸压缩会改变图片分辨率，影响显示效果"),m("li",null,"• 某些特殊格式的图片可能不适合压缩"),m("li",null,"• 建议先压缩少量图片测试效果，再批量处理")])])],-1)])),_:1,__:[27]})])}}}),[["__scopeId","data-v-3641b6c3"]]);export{ge as default};

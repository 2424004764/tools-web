var e=(e,t,s)=>new Promise((a,o)=>{var l=e=>{try{i(s.next(e))}catch(t){o(t)}},r=e=>{try{i(s.throw(e))}catch(t){o(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,r);i((s=s.apply(e,t)).next())});import{E as t,o as s}from"./chunk-0a8d181f.js";import{j as a}from"./chunk-0bf95de0.js";import{b as o,_ as l}from"../assets/index-139225df.js";import{a as r}from"./chunk-96adf8d3.js";import{d as i,r as n,b as c,t as d,al as u,o as g,c as m,a as h,P as p,R as y,J as f,u as x,M as b,O as w}from"./chunk-bb5ca2a1.js";import"./chunk-b045bb46.js";const v={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-4 sm:p-10"},k={class:"w-full max-w-sm sm:max-w-md"},_={class:"text-center mb-8"},j={class:"text-gray-600"},E={class:"space-y-4 sm:space-y-6"},G={class:"flex justify-center"},q=["disabled"],Q={key:0,class:"text-sm font-medium text-gray-600 truncate"},S={key:1,class:"flex items-center"},C={class:"flex justify-center"},L=["disabled"],z={key:0,class:"text-sm font-medium text-gray-600 truncate"},U={key:1,class:"flex items-center"},H={class:"flex justify-center"},A=["disabled"],I={key:0,class:"text-sm font-medium text-gray-600 truncate"},B={key:1,class:"flex items-center"},M={class:"flex justify-center"},N=["disabled"],O={key:0,class:"text-sm font-medium text-gray-600 truncate"},P={key:1,class:"flex items-center"},T={class:"flex justify-center"},K=["disabled"],D={key:0,class:"text-sm font-medium text-gray-600 truncate"},J={key:1,class:"flex items-center"},R={key:0,class:"text-center"},W={key:1,class:"text-center"},X=l(i({__name:"Login",setup(l){const i=n("一方工具箱"),X=n("https://tool.fologde.com"),$=n(!1),F=n(!1),V=n(!1),Y=n(!1),Z=n(!1),ee=n(!1),te=o(),se=c(()=>te.getLoginStatus);d(()=>{if(te.initUserState(),te.getLoginStatus)return void(window.location.href="/userinfo");const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{ee.value=!0,le()},document.head.appendChild(e),window.addEventListener("message",ue)});const ae=()=>{void 0!==window.google?window.google.accounts.id.prompt(e=>{(e.isNotDisplayed()||e.isSkippedMoment())&&oe()}):t.error("Google登录服务未加载，请刷新页面重试")},oe=()=>{if(void 0!==window.google){const e=document.createElement("div");e.style.display="none",document.body.appendChild(e),window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",type:"standard"}),setTimeout(()=>{const t=e.querySelector('[role="button"]');t&&t.click(),document.body.removeChild(e)},100)}},le=()=>{if(void 0!==window.google){window.google.accounts.id.initialize({client_id:"825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",callback:re,auto_select:!1,cancel_on_tap_outside:!0});const e=document.getElementById("google-signin-button");e&&window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left"})}},re=s=>e(this,null,function*(){if(s.credential){$.value=!0;try{const e=yield r.post("/google-auth",{credential:s.credential});if(!e.data.success)throw new Error(e.data.error||"认证失败");{const s=a(e.data.token);t.success(`欢迎回来，${s.username}！`),localStorage.setItem("TOKEN",e.data.token),te.initUserState(),window.location.href="/userinfo"}}catch(e){t.error("谷歌登录失败，请重试")}finally{$.value=!1}}}),ie=()=>e(this,null,function*(){try{F.value=!0;const e=yield r.post(X.value+"/linuxdo-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("Linux.do登录配置错误");if(!window.open(e.data.auth_url,"linuxdo-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){t.error("Linux.do登录失败，请重试"),F.value=!1}}),ne=()=>e(this,null,function*(){try{V.value=!0;const e=yield r.post(X.value+"/gitee-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("Gitee登录配置错误");if(!window.open(e.data.auth_url,"gitee-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){t.error("Gitee登录失败，请重试"),V.value=!1}}),ce=()=>e(this,null,function*(){try{Y.value=!0;const e=yield r.post(X.value+"/github-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("GitHub登录配置错误");if(!window.open(e.data.auth_url,"github-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){t.error("GitHub登录失败，请重试"),Y.value=!1}}),de=()=>e(this,null,function*(){try{Z.value=!0;const e=yield r.post(X.value+"/qq-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("QQ登录配置错误");if(!window.open(e.data.auth_url,"qq-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){t.error("QQ登录失败，请重试"),Z.value=!1}}),ue=e=>{var s;["https://connect.linux.do","https://gitee.com","https://github.com","https://graph.qq.com",X.value,window.location.origin].some(t=>e.origin.startsWith(t))&&e.data&&"object"==typeof e.data&&["success","error"].includes(null==(s=e.data)?void 0:s.type)&&("success"===e.data.type&&e.data.success?(localStorage.setItem("TOKEN",e.data.data.token),te.initUserState(),t.success(e.data.message||"登录成功"),window.location.href="/userinfo"):"error"!==e.data.type&&e.data.success||t.error(e.data.message||"登录失败，请重试"),F.value=!1,V.value=!1,Y.value=!1,Z.value=!1)},ge=()=>{void 0!==window.google&&window.google.accounts.id.disableAutoSelect(),te.logout(),t.success("已退出登录")};return(e,t)=>{const a=u("el-icon"),o=u("el-button");return g(),m("div",v,[h("div",k,[h("div",_,[t[0]||(t[0]=h("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2"},"用户登录",-1)),h("p",j,"欢迎使用"+p(i.value),1)]),h("div",E,[h("div",G,[h("button",{onClick:de,disabled:Z.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[2]||(t[2]=h("img",{src:"/images/logo/qq.png",alt:"QQ",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),Z.value?(g(),m("div",S,[y(a,{class:"is-loading mr-2"},{default:f(()=>[y(x(s))]),_:1}),t[1]||(t[1]=h("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(g(),m("span",Q," 使用 QQ 登录 "))],8,q)]),h("div",C,[h("button",{onClick:ie,disabled:F.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[4]||(t[4]=h("img",{src:"https://linux.do/uploads/default/original/4X/c/c/d/ccd8c210609d498cbeb3d5201d4c259348447562.png",alt:"Linux.do",class:"w-5 h-5 mr-3 flex-shrink-0"},null,-1)),F.value?(g(),m("div",U,[y(a,{class:"is-loading mr-2"},{default:f(()=>[y(x(s))]),_:1}),t[3]||(t[3]=h("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(g(),m("span",z," 使用 Linux.do 登录 "))],8,L)]),h("div",H,[h("button",{onClick:ne,disabled:V.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[6]||(t[6]=h("img",{src:"https://gitee.com/static/images/logo-black.svg?t=158106664",alt:"Gitee",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),V.value?(g(),m("div",B,[y(a,{class:"is-loading mr-2"},{default:f(()=>[y(x(s))]),_:1}),t[5]||(t[5]=h("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(g(),m("span",I," 使用 Gitee 登录 "))],8,A)]),t[13]||(t[13]=h("div",{class:"flex items-center"},[h("div",{class:"flex-1 border-t border-gray-200"}),h("span",{class:"px-3 text-sm text-gray-500"},"或"),h("div",{class:"flex-1 border-t border-gray-200"})],-1)),h("div",M,[h("button",{onClick:ae,disabled:$.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[8]||(t[8]=h("img",{src:"https://developers.google.com/identity/images/g-logo.png",alt:"Google",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),$.value?(g(),m("div",P,[y(a,{class:"is-loading mr-2"},{default:f(()=>[y(x(s))]),_:1}),t[7]||(t[7]=h("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(g(),m("span",O," 使用 Google 登录 "))],8,N)]),t[14]||(t[14]=h("div",{style:{display:"none"}},[h("div",{id:"google-signin-button"})],-1)),h("div",T,[h("button",{onClick:ce,disabled:Y.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[10]||(t[10]=h("img",{src:"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",alt:"GitHub",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),Y.value?(g(),m("div",J,[y(a,{class:"is-loading mr-2"},{default:f(()=>[y(x(s))]),_:1}),t[9]||(t[9]=h("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(g(),m("span",D," 使用 GitHub 登录 "))],8,K)]),$.value?(g(),m("div",R,[y(a,{class:"is-loading"},{default:f(()=>[y(x(s))]),_:1}),t[11]||(t[11]=h("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):b("",!0),t[15]||(t[15]=h("div",{class:"text-center text-gray-500 text-xs sm:text-sm px-2"},[h("p",null,"支持谷歌账号、GitHub账号、QQ账号、Linux.do账号和Gitee账号登录"),h("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),se.value?(g(),m("div",W,[y(o,{type:"danger",size:"small",onClick:ge},{default:f(()=>t[12]||(t[12]=[w(" 退出登录 ",-1)])),_:1,__:[12]})])):b("",!0)])])])}}}),[["__scopeId","data-v-cbde826e"]]);export{X as default};

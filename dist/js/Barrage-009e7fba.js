import{_ as e}from"./chunk-6b313974.js";import{_ as t}from"./chunk-9c6aa90d.js";import{o as a,c as l,a as n,D as s,C as u,d as o,r as d,b as i,q as r,t as m,X as c,au as p,ac as v,v as f,a2 as h,al as y,R as g,J as x,P as b,E as k,u as _,O as S}from"./chunk-bb5ca2a1.js";import{_ as w}from"../assets/index-2738d5ba.js";import"./chunk-7296d483.js";import"./chunk-c8f53b98.js";import"./chunk-dd4ac5f9.js";var C=o({name:"vue3-danmaku",components:{},props:{danmus:{type:Array,required:!0,default:()=>[]},channels:{type:Number,default:0},autoplay:{type:Boolean,default:!0},loop:{type:Boolean,default:!1},useSlot:{type:Boolean,default:!1},debounce:{type:Number,default:100},speeds:{type:Number,default:200},randomChannel:{type:Boolean,default:!1},fontSize:{type:Number,default:18},top:{type:Number,default:4},right:{type:Number,default:0},isSuspend:{type:Boolean,default:!1},extraStyle:{type:String,default:""}},emits:["list-end","play-end","dm-over","dm-out","update:danmus"],setup(e,{emit:t,slots:a}){let l=d(document.createElement("div")),n=d(document.createElement("div"));const s=d(0),u=d(0);let o=0;const h=d(0),y=d(0),g=d(0),x=d(!1),b=d(!1),k=d({}),_=function(e,t,a="modelValue"){return i({get:()=>e[a],set:e=>{t(`update:${a}`,e)}})}(e,t,"danmus"),S=r({channels:i(()=>e.channels||h.value),autoplay:i(()=>e.autoplay),loop:i(()=>e.loop),useSlot:i(()=>e.useSlot),debounce:i(()=>e.debounce),randomChannel:i(()=>e.randomChannel)}),w=r({height:i(()=>y.value),fontSize:i(()=>e.fontSize),speeds:i(()=>e.speeds),top:i(()=>e.top),right:i(()=>e.right)});function C(){z(),e.isSuspend&&function(){let e=[];n.value.addEventListener("mouseover",a=>{let l=a.target;l.className.includes("dm")||(l=l.closest(".dm")||l),l.className.includes("dm")&&(e.includes(l)||(t("dm-over",{el:l}),l.classList.add("pause"),e.push(l)))}),n.value.addEventListener("mouseout",a=>{let l=a.target;l.className.includes("dm")||(l=l.closest(".dm")||l),l.className.includes("dm")&&(t("dm-out",{el:l}),l.classList.remove("pause"),e.forEach(e=>{e.classList.remove("pause")}),e=[])})}(),S.autoplay&&L()}function z(){if(s.value=l.value.offsetWidth,u.value=l.value.offsetHeight,0===s.value||0===u.value)throw new Error("获取不到容器宽高")}function L(){b.value=!1,o||(o=window.setInterval(()=>function(){if(!b.value&&_.value.length)if(g.value>_.value.length-1){const e=n.value.children.length;S.loop&&(e<g.value&&(t("list-end"),g.value=0),V())}else V()}(),S.debounce))}function V(l){const o=S.loop?g.value%_.value.length:g.value,d=l||_.value[o];let i=document.createElement("div");var r,m;S.useSlot?i=(r=d,m=o,p({render:()=>v("div",{},[a.dm&&a.dm({danmu:r,index:m})])}).mount(document.createElement("div"))).$el:(i.innerHTML=d,i.setAttribute("style",e.extraStyle),i.style.fontSize=`${w.fontSize}px`,i.style.lineHeight=`${w.fontSize}px`),i.classList.add("dm"),n.value.appendChild(i),i.style.opacity="0",f(()=>{w.height||(y.value=i.offsetHeight),S.channels||(h.value=Math.floor(u.value/(w.height+w.top)));let e=function(e){let t=[...Array(S.channels).keys()];S.randomChannel&&(t=t.sort(()=>.5-Math.random()));for(let a of t){const t=k.value[a];if(!t||!t.length)return k.value[a]=[e],e.addEventListener("animationend",()=>k.value[a].splice(0,1)),a%S.channels;for(let l=0;l<t.length;l++){const n=E(t[l])-10;if(n<=.88*(e.offsetWidth-t[l].offsetWidth)||n<=0)break;if(l===t.length-1)return k.value[a].push(e),e.addEventListener("animationend",()=>k.value[a].splice(0,1)),a%S.channels}}return-1}(i);if(e>=0){const a=i.offsetWidth,l=w.height;i.classList.add("move"),i.dataset.index=`${o}`,i.dataset.channel=e.toString(),i.style.opacity="1",i.style.top=e*(l+w.top)+"px",i.style.width=a+w.right+"px",i.style.setProperty("--dm-scroll-width",`-${s.value+a}px`),i.style.left=`${s.value}px`,i.style.animationDuration=s.value/w.speeds+"s",i.addEventListener("animationend",()=>{Number(i.dataset.index)!==_.value.length-1||S.loop||t("play-end",i.dataset.index),n.value&&n.value.removeChild(i)}),g.value++}else n.value.removeChild(i)})}function E(e){const t=e.offsetWidth||parseInt(e.style.width),a=e.getBoundingClientRect().right||n.value.getBoundingClientRect().right+t;return n.value.getBoundingClientRect().right-a}function F(){clearInterval(o),o=0,g.value=0}return m(()=>{C()}),c(()=>{F()}),{container:l,dmContainer:n,hidden:x,paused:b,danmuList:_,getPlayState:function(){return!b.value},resize:function(){z();const e=n.value.getElementsByClassName("dm");for(let t=0;t<e.length;t++){const a=e[t];a.style.setProperty("--dm-scroll-width",`-${s.value+a.offsetWidth}px`),a.style.left=`${s.value}px`,a.style.animationDuration=s.value/w.speeds+"s"}},play:L,pause:function(){b.value=!0},stop:function(){k.value={},n.value.innerHTML="",b.value=!0,x.value=!1,F()},show:function(){x.value=!1},hide:function(){x.value=!0},reset:function(){y.value=0,C()},add:function(e){if(g.value===_.value.length)return _.value.push(e),_.value.length-1;{const t=g.value%_.value.length;return _.value.splice(t,0,e),t+1}},push:function(e){return _.value.push(e),_.value.length-1},insert:V}}});const z={ref:"container",class:"vue-danmaku"};!function(e,t){void 0===t&&(t={});var a=t.insertAt;if("undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===a&&l.firstChild?l.insertBefore(n,l.firstChild):l.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}(".vue-danmaku {\n  position: relative;\n  overflow: hidden;\n}\n.vue-danmaku .danmus {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  -webkit-transition: all 0.3s;\n  transition: all 0.3s;\n}\n.vue-danmaku .danmus.show {\n  opacity: 1;\n}\n.vue-danmaku .danmus.paused .dm.move {\n  animation-play-state: paused;\n}\n.vue-danmaku .danmus .dm {\n  position: absolute;\n  font-size: 20px;\n  color: #ddd;\n  white-space: pre;\n  transform: translateX(0);\n  transform-style: preserve-3d;\n}\n.vue-danmaku .danmus .dm.move {\n  will-change: transform;\n  animation-name: moveLeft;\n  animation-timing-function: linear;\n  animation-play-state: running;\n}\n.vue-danmaku .danmus .dm.pause {\n  animation-play-state: paused;\n  z-index: 100;\n}\n@keyframes moveLeft {\n  from {\n    transform: translateX(0);\n  }\n  to {\n    transform: translateX(var(--dm-scroll-width));\n  }\n}\n@-webkit-keyframes moveLeft {\n  from {\n    -webkit-transform: translateX(0);\n  }\n  to {\n    -webkit-transform: translateX(var(--dm-scroll-width));\n  }\n}"),C.render=function(e,t,o,d,i,r){return a(),l("div",z,[n("div",{ref:"dmContainer",class:s(["danmus",{show:!e.hidden},{paused:e.paused}])},null,2),u(e.$slots,"default")],512)},C.__file="src/lib/Danmaku.vue";const L={class:"flex flex-col mt-3 flex-1"},V={class:"p-4 rounded-2xl bg-white"},E={class:"flex mb-2"},F={class:"w-72"},N={class:"flex mb-2"},B={class:"w-72 ml-2"},$={class:"flex mb-2"},P={class:"w-72 ml-2"},W={class:"flex mb-2"},j={class:"flex mb-2"},H=w(o({__name:"Barrage",setup(s){const u=r({title:"手持弹幕",content:"工具坊",barrage:[],speed:200,textSize:500,textColor:"#FFFFFF",bgColor:"#000000",channels:1,extraStyle:"",danmakuFullStyle:"",isPlay:!1,danmakuFullHeight:"100%",danmakuFullWidth:"100%"}),o=d(null),i=()=>{u.isPlay?(m("visibility: hidden;"),o.value.resize(),o.value.stop(),u.isPlay=!1):(m(),c(),o.value.resize(),o.value.play(),u.isPlay=!0)},m=(e="")=>{u.extraStyle="color: "+u.textColor+";font-size: "+u.textSize+"px",u.danmakuFullStyle="z-index: 99; position: fixed; top: 0px; left: 0px; height:"+u.danmakuFullHeight+"; width:"+u.danmakuFullWidth+"; background-color:"+u.bgColor+";"+e},c=()=>{u.barrage[0]=u.content};return h(()=>{m("visibility: hidden;")}),(s,d)=>{const r=y("el-text"),c=y("el-input"),p=y("el-slider"),v=y("el-color-picker"),f=y("el-button");return a(),l("div",L,[g(e,{title:u.title},null,8,["title"]),g(_(C),{ref_key:"danmakuFullRef",ref:o,danmus:u.barrage,"onUpdate:danmus":d[0]||(d[0]=e=>u.barrage=e),loop:"",autoplay:!1,speeds:u.speed,channels:u.channels,extraStyle:u.extraStyle,style:k(u.danmakuFullStyle),onDblclick:i,useSlot:!0},{dm:x(({danmu:e})=>[n("div",{class:"",style:k(u.extraStyle)},[n("span",null,b(e),1)],4)]),_:1},8,["danmus","speeds","channels","extraStyle","style"]),n("div",V,[n("div",E,[g(r,{class:"w-20"},{default:x(()=>d[8]||(d[8]=[S("弹幕内容:",-1)])),_:1,__:[8]}),n("div",F,[g(c,{modelValue:u.content,"onUpdate:modelValue":d[1]||(d[1]=e=>u.content=e),type:"textarea",rows:3},null,8,["modelValue"])])]),n("div",N,[g(r,{class:"w-20"},{default:x(()=>d[9]||(d[9]=[S("播放速度:",-1)])),_:1,__:[9]}),n("div",B,[g(p,{modelValue:u.speed,"onUpdate:modelValue":d[2]||(d[2]=e=>u.speed=e),min:1,max:500},null,8,["modelValue"])])]),n("div",$,[g(r,{class:"w-20"},{default:x(()=>d[10]||(d[10]=[S("文字大小:",-1)])),_:1,__:[10]}),n("div",P,[g(p,{modelValue:u.textSize,"onUpdate:modelValue":d[3]||(d[3]=e=>u.textSize=e),min:12,max:1e3},null,8,["modelValue"])])]),n("div",W,[g(r,{class:"w-20"},{default:x(()=>d[11]||(d[11]=[S("文字颜色:",-1)])),_:1,__:[11]}),n("div",null,[g(v,{modelValue:u.textColor,"onUpdate:modelValue":d[4]||(d[4]=e=>u.textColor=e),size:"large",onChange:d[5]||(d[5]=e=>m())},null,8,["modelValue"])])]),n("div",j,[g(r,{class:"w-20"},{default:x(()=>d[12]||(d[12]=[S("背景颜色:",-1)])),_:1,__:[12]}),n("div",null,[g(v,{modelValue:u.bgColor,"onUpdate:modelValue":d[6]||(d[6]=e=>u.bgColor=e),size:"large",onChange:d[7]||(d[7]=e=>m())},null,8,["modelValue"])])]),n("div",null,[g(f,{onClick:i,type:"primary",class:"mr-3"},{default:x(()=>[S(b(0==u.isPlay?"播放":"暂停"),1)]),_:1}),g(r,null,{default:x(()=>d[13]||(d[13]=[S("双击可退出弹幕",-1)])),_:1,__:[13]})])]),g(t,{title:"描述"},{default:x(()=>[g(r,null,{default:x(()=>d[14]||(d[14]=[S(" 手持弹幕是一种新型的互动沟通工具，可以方便地为各种户外活动、演出嘉年华等活动增加趣味性和互动性。手持弹幕具有轻便、易携带、易操作等优点，可以让每个参与者都变成活动的一部分。同时，手持弹幕还可以通过预先编写的文本、表情等形式，表达参与者的情感和想法，实现沟通互动。在社交媒体时代，手持弹幕的使用也带来了更广泛的社交效应，增加了活动的互动性和传播度。无论是举办方还是参与者，手持弹幕都是一个非常有价值的互动工具。 ",-1)])),_:1,__:[14]})]),_:1})])}}}),[["__scopeId","data-v-13705924"]]);export{H as default};

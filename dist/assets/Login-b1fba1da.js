import{d as H,r as l,s as O,J as B,o as T,ac as x,y as r,f as _,g as o,h as a,j as s,t as A,m as n,l as d,q as u,an as g,v,p as D,_ as M}from"./index-9a231041.js";import{j as V}from"./index-bcdd064d.js";const K="/images/logo/qq.png",J={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-4 sm:p-10"},P={class:"w-full max-w-sm sm:max-w-md"},X={class:"text-center mb-8"},$={class:"text-gray-600"},F={class:"space-y-4 sm:space-y-6"},R={class:"flex justify-center"},Y=["disabled"],Z={key:0,class:"text-sm font-medium text-gray-600 truncate"},ee={key:1,class:"flex items-center"},te={class:"flex justify-center"},se=["disabled"],oe={key:0,class:"text-sm font-medium text-gray-600 truncate"},ae={key:1,class:"flex items-center"},ne={class:"flex justify-center"},ie=["disabled"],re={key:0,class:"text-sm font-medium text-gray-600 truncate"},le={key:1,class:"flex items-center"},de={class:"flex justify-center"},ce=["disabled"],ue={key:0,class:"text-sm font-medium text-gray-600 truncate"},ge={key:1,class:"flex items-center"},me={class:"flex justify-center"},fe=["disabled"],pe={key:0,class:"text-sm font-medium text-gray-600 truncate"},he={key:1,class:"flex items-center"},we={key:0,class:"text-center"},ye={key:1,class:"text-center"},xe=H({__name:"Login",setup(be){const k=l("一方工具箱"),m=l("https://tool.fologde.com"),f=l(!1),p=l(!1),h=l(!1),w=l(!1),y=l(!1),L=l(!1),c=O(),G="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",E=B(()=>c.getLoginStatus);T(()=>{if(c.initUserState(),c.getLoginStatus){window.location.href="/userinfo";return}const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{L.value=!0,C()},document.head.appendChild(e),window.addEventListener("message",W)});const j=()=>{typeof window.google<"u"?window.google.accounts.id.prompt(e=>{(e.isNotDisplayed()||e.isSkippedMoment())&&S()}):r.error("Google登录服务未加载，请刷新页面重试")},S=()=>{if(typeof window.google<"u"){const e=document.createElement("div");e.style.display="none",document.body.appendChild(e),window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",type:"standard"}),setTimeout(()=>{const t=e.querySelector('[role="button"]');t&&t.click(),document.body.removeChild(e)},100)}},C=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:G,callback:q,auto_select:!1,cancel_on_tap_outside:!0});const e=document.getElementById("google-signin-button");e&&window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left"})}},q=async e=>{if(e.credential){f.value=!0;try{const t=await x.post("/google-auth",{credential:e.credential});if(t.data.success){const i=V(t.data.token);console.log("jwt",i),r.success(`欢迎回来，${i.username}！`),localStorage.setItem("TOKEN",t.data.token),c.initUserState(),window.location.href="/userinfo"}else throw new Error(t.data.error||"认证失败")}catch(t){r.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",t)}finally{f.value=!1}}},Q=async()=>{try{p.value=!0;const e=await x.post(m.value+"/linuxdo-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("Linux.do登录配置错误");if(!window.open(e.data.auth_url,"linuxdo-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){console.error("Linux.do login error:",e),r.error("Linux.do登录失败，请重试"),p.value=!1}},z=async()=>{try{h.value=!0;const e=await x.post(m.value+"/gitee-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("Gitee登录配置错误");if(!window.open(e.data.auth_url,"gitee-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){console.error("Gitee login error:",e),r.error("Gitee登录失败，请重试"),h.value=!1}},I=async()=>{try{w.value=!0;const e=await x.post(m.value+"/github-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("GitHub登录配置错误");if(!window.open(e.data.auth_url,"github-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){console.error("GitHub login error:",e),r.error("GitHub登录失败，请重试"),w.value=!1}},U=async()=>{try{y.value=!0;const e=await x.post(m.value+"/qq-auth",{params:{action:"getAuthUrl"}});if(!e.data.success)throw new Error("QQ登录配置错误");if(!window.open(e.data.auth_url,"qq-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(e){console.error("QQ login error:",e),r.error("QQ登录失败，请重试"),y.value=!1}},W=e=>{var i;["https://connect.linux.do","https://gitee.com","https://github.com","https://graph.qq.com",m.value,window.location.origin].some(b=>e.origin.startsWith(b))&&(!e.data||typeof e.data!="object"||["success","error"].includes((i=e.data)==null?void 0:i.type)&&(e.data.type==="success"&&e.data.success?(localStorage.setItem("TOKEN",e.data.data.token),c.initUserState(),r.success(e.data.message||"登录成功"),window.location.href="/userinfo"):(e.data.type==="error"||!e.data.success)&&r.error(e.data.message||"登录失败，请重试"),p.value=!1,h.value=!1,w.value=!1,y.value=!1))},N=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),c.logout(),r.success("已退出登录")};return(e,t)=>{const i=_("el-icon"),b=_("el-button");return o(),a("div",J,[s("div",P,[s("div",X,[t[0]||(t[0]=s("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2"},"用户登录",-1)),s("p",$,"欢迎使用"+A(k.value),1)]),s("div",F,[s("div",R,[s("button",{onClick:U,disabled:y.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[2]||(t[2]=s("img",{src:K,alt:"QQ",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),y.value?(o(),a("div",ee,[n(i,{class:"is-loading mr-2"},{default:d(()=>[n(u(g))]),_:1}),t[1]||(t[1]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(o(),a("span",Z," 使用 QQ 登录 "))],8,Y)]),s("div",te,[s("button",{onClick:Q,disabled:p.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[4]||(t[4]=s("img",{src:"https://linux.do/uploads/default/original/4X/c/c/d/ccd8c210609d498cbeb3d5201d4c259348447562.png",alt:"Linux.do",class:"w-5 h-5 mr-3 flex-shrink-0"},null,-1)),p.value?(o(),a("div",ae,[n(i,{class:"is-loading mr-2"},{default:d(()=>[n(u(g))]),_:1}),t[3]||(t[3]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(o(),a("span",oe," 使用 Linux.do 登录 "))],8,se)]),s("div",ne,[s("button",{onClick:z,disabled:h.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[6]||(t[6]=s("img",{src:"https://gitee.com/static/images/logo-black.svg?t=158106664",alt:"Gitee",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),h.value?(o(),a("div",le,[n(i,{class:"is-loading mr-2"},{default:d(()=>[n(u(g))]),_:1}),t[5]||(t[5]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(o(),a("span",re," 使用 Gitee 登录 "))],8,ie)]),t[13]||(t[13]=s("div",{class:"flex items-center"},[s("div",{class:"flex-1 border-t border-gray-200"}),s("span",{class:"px-3 text-sm text-gray-500"},"或"),s("div",{class:"flex-1 border-t border-gray-200"})],-1)),s("div",de,[s("button",{onClick:j,disabled:f.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[8]||(t[8]=s("img",{src:"https://developers.google.com/identity/images/g-logo.png",alt:"Google",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),f.value?(o(),a("div",ge,[n(i,{class:"is-loading mr-2"},{default:d(()=>[n(u(g))]),_:1}),t[7]||(t[7]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(o(),a("span",ue," 使用 Google 登录 "))],8,ce)]),t[14]||(t[14]=s("div",{style:{display:"none"}},[s("div",{id:"google-signin-button"})],-1)),s("div",me,[s("button",{onClick:I,disabled:w.value,class:"flex items-center justify-center w-full h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors px-4"},[t[10]||(t[10]=s("img",{src:"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",alt:"GitHub",class:"h-5 w-auto mr-3 flex-shrink-0"},null,-1)),w.value?(o(),a("div",he,[n(i,{class:"is-loading mr-2"},{default:d(()=>[n(u(g))]),_:1}),t[9]||(t[9]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(o(),a("span",pe," 使用 GitHub 登录 "))],8,fe)]),f.value?(o(),a("div",we,[n(i,{class:"is-loading"},{default:d(()=>[n(u(g))]),_:1}),t[11]||(t[11]=s("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):v("",!0),t[15]||(t[15]=s("div",{class:"text-center text-gray-500 text-xs sm:text-sm px-2"},[s("p",null,"支持谷歌账号、GitHub账号、QQ账号、Linux.do账号和Gitee账号登录"),s("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),E.value?(o(),a("div",ye,[n(b,{type:"danger",size:"small",onClick:N},{default:d(()=>t[12]||(t[12]=[D(" 退出登录 ",-1)])),_:1,__:[12]})])):v("",!0)])])])}}});const ke=M(xe,[["__scopeId","data-v-cbde826e"]]);export{ke as default};

import{d as W,r as l,s as H,J as N,o as O,ac as p,y as i,f as _,g as a,h as r,j as s,t as A,m as n,l as c,q as w,an as x,v,p as B,_ as T}from"./index-cec493a3.js";import{j as M}from"./index-bcdd064d.js";const V={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},D={class:"w-96"},K={class:"text-center mb-8"},J={class:"text-gray-600"},X={class:"space-y-6"},$={class:"flex justify-center"},F=["disabled"],P={key:0,class:"text-sm font-medium text-gray-600"},R={key:1,class:"flex items-center"},Y={class:"flex justify-center"},Z=["disabled"],tt={key:0,class:"text-sm font-medium text-gray-600"},et={key:1,class:"flex items-center"},st={class:"flex justify-center"},ot=["disabled"],at={key:0,class:"text-sm font-medium text-gray-600"},rt={key:1,class:"flex items-center"},nt={class:"flex justify-center"},it=["disabled"],lt={key:0,class:"text-sm font-medium text-gray-600"},dt={key:1,class:"flex items-center"},ct={key:0,class:"text-center"},ut={key:1,class:"text-center"},gt=W({__name:"Login",setup(ft){const L=l("一方工具箱"),u=l("https://tool.fologde.com"),y=l(!1),g=l(!1),f=l(!1),m=l(!1),h=l(!1),k=l(!1),d=H(),G="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",E=N(()=>d.getLoginStatus);O(()=>{if(d.initUserState(),d.getLoginStatus){window.location.href="/userinfo";return}const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{k.value=!0,j()},document.head.appendChild(t),window.addEventListener("message",I)});const j=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:G,callback:Q,auto_select:!1,cancel_on_tap_outside:!0});const t=document.getElementById("google-signin-button");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},Q=async t=>{if(t.credential){y.value=!0;try{const e=await p.post("/google-auth",{credential:t.credential});if(e.data.success){const o=M(e.data.token);console.log("jwt",o),i.success(`欢迎回来，${o.username}！`),localStorage.setItem("TOKEN",e.data.token),d.initUserState(),window.location.href="/userinfo"}else throw new Error(e.data.error||"认证失败")}catch(e){i.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{y.value=!1}}},S=async()=>{try{g.value=!0;const t=await p.post(u.value+"/linuxdo-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("Linux.do登录配置错误");if(!window.open(t.data.auth_url,"linuxdo-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("Linux.do login error:",t),i.error("Linux.do登录失败，请重试"),g.value=!1}},q=async()=>{try{f.value=!0;const t=await p.post(u.value+"/gitee-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("Gitee登录配置错误");if(!window.open(t.data.auth_url,"gitee-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("Gitee login error:",t),i.error("Gitee登录失败，请重试"),f.value=!1}},C=async()=>{try{m.value=!0;const t=await p.post(u.value+"/github-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("GitHub登录配置错误");if(!window.open(t.data.auth_url,"github-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("GitHub login error:",t),i.error("GitHub登录失败，请重试"),m.value=!1}},z=async()=>{try{h.value=!0;const t=await p.post(u.value+"/qq-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("QQ登录配置错误");if(!window.open(t.data.auth_url,"qq-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("QQ login error:",t),i.error("QQ登录失败，请重试"),h.value=!1}},I=t=>{var o;["https://connect.linux.do","https://gitee.com","https://github.com","https://graph.qq.com",u.value,window.location.origin].some(b=>t.origin.startsWith(b))&&(!t.data||typeof t.data!="object"||["success","error"].includes((o=t.data)==null?void 0:o.type)&&(t.data.type==="success"&&t.data.success?(localStorage.setItem("TOKEN",t.data.data.token),d.initUserState(),i.success(t.data.message||"登录成功"),window.location.href="/userinfo"):(t.data.type==="error"||!t.data.success)&&i.error(t.data.message||"登录失败，请重试"),g.value=!1,f.value=!1,m.value=!1,h.value=!1))},U=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),d.logout(),i.success("已退出登录")};return(t,e)=>{const o=_("el-icon"),b=_("el-button");return a(),r("div",V,[s("div",D,[s("div",K,[e[0]||(e[0]=s("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录",-1)),s("p",J,"欢迎使用"+A(L.value),1)]),s("div",X,[e[11]||(e[11]=s("div",{class:"flex justify-center"},[s("div",{id:"google-signin-button"})],-1)),s("div",$,[s("button",{onClick:C,disabled:m.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[2]||(e[2]=s("img",{src:"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",alt:"GitHub",class:"h-5 w-auto mr-3"},null,-1)),m.value?(a(),r("div",R,[n(o,{class:"is-loading mr-2"},{default:c(()=>[n(w(x))]),_:1}),e[1]||(e[1]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),r("span",P," 使用 GitHub 登录 "))],8,F)]),s("div",Y,[s("button",{onClick:z,disabled:h.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[4]||(e[4]=s("img",{src:"https://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Connect_logo_7.png",alt:"QQ",class:"h-5 w-auto mr-3"},null,-1)),h.value?(a(),r("div",et,[n(o,{class:"is-loading mr-2"},{default:c(()=>[n(w(x))]),_:1}),e[3]||(e[3]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),r("span",tt," 使用 QQ 登录 "))],8,Z)]),s("div",st,[s("button",{onClick:S,disabled:g.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[6]||(e[6]=s("img",{src:"https://linux.do/uploads/default/original/4X/c/c/d/ccd8c210609d498cbeb3d5201d4c259348447562.png",alt:"Linux.do",class:"w-5 h-5 mr-3"},null,-1)),g.value?(a(),r("div",rt,[n(o,{class:"is-loading mr-2"},{default:c(()=>[n(w(x))]),_:1}),e[5]||(e[5]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),r("span",at," 使用 Linux.do 登录 "))],8,ot)]),s("div",nt,[s("button",{onClick:q,disabled:f.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[8]||(e[8]=s("img",{src:"https://gitee.com/static/images/logo-black.svg?t=158106664",alt:"Gitee",class:"h-5 w-auto mr-3"},null,-1)),f.value?(a(),r("div",dt,[n(o,{class:"is-loading mr-2"},{default:c(()=>[n(w(x))]),_:1}),e[7]||(e[7]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),r("span",lt," 使用 Gitee 登录 "))],8,it)]),e[12]||(e[12]=s("div",{class:"flex items-center"},[s("div",{class:"flex-1 border-t border-gray-200"}),s("span",{class:"px-3 text-sm text-gray-500"},"或"),s("div",{class:"flex-1 border-t border-gray-200"})],-1)),y.value?(a(),r("div",ct,[n(o,{class:"is-loading"},{default:c(()=>[n(w(x))]),_:1}),e[9]||(e[9]=s("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):v("",!0),e[13]||(e[13]=s("div",{class:"text-center text-gray-500 text-sm"},[s("p",null,"支持谷歌账号、GitHub账号、QQ账号、Linux.do账号和Gitee账号登录"),s("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),E.value?(a(),r("div",ut,[n(b,{type:"danger",size:"small",onClick:U},{default:c(()=>e[10]||(e[10]=[B(" 退出登录 ",-1)])),_:1,__:[10]})])):v("",!0)])])])}}});const pt=T(gt,[["__scopeId","data-v-55b39a73"]]);export{pt as default};

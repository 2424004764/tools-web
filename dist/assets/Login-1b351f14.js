import{d as h,l as i,J as b,o as E,p as k,q as I,E as r,r as g,b as c,c as d,f as t,i as u,h as f,k as j,ai as T,K as _,j as C,_ as N}from"./index-bb45300a.js";import{j as S}from"./index-bcdd064d.js";const O={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},L={class:"w-96"},z={class:"space-y-6"},B={key:0,class:"text-center"},G={key:1,class:"text-center"},V=h({__name:"Login",setup(q){const a=i(!1),p=i(!1),l=i(null),m="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",w=b(()=>!!l.value);E(()=>{const o=k();if(o&&!I()){l.value=o,window.location.href="/userinfo";return}const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{p.value=!0,v()},document.head.appendChild(e)});const v=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:m,callback:x,auto_select:!1,cancel_on_tap_outside:!0});const o=document.getElementById("google-signin-button");o&&window.google.accounts.id.renderButton(o,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},x=async o=>{if(o.credential){a.value=!0;try{const e=await fetch("/google-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:o.credential})});if(!e.ok)throw new Error("认证请求失败");const n=await e.json();if(n.success){const s=S(n.token);console.log("jwt",s),r.success(`欢迎回来，${s.username}！`),localStorage.setItem("TOKEN",n.token),window.location.href="/userinfo"}else throw new Error(n.error||"认证失败")}catch(e){r.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{a.value=!1}}},y=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),l.value=null,localStorage.removeItem("TOKEN"),r.success("已退出登录")};return(o,e)=>{const n=g("el-icon"),s=g("el-button");return c(),d("div",O,[t("div",L,[e[4]||(e[4]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录"),t("p",{class:"text-gray-600"},"欢迎使用Tools-Web工具箱")],-1)),t("div",z,[e[2]||(e[2]=t("div",{class:"flex justify-center"},[t("div",{id:"google-signin-button"})],-1)),a.value?(c(),d("div",B,[u(n,{class:"is-loading"},{default:f(()=>[u(j(T))]),_:1}),e[0]||(e[0]=t("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):_("",!0),e[3]||(e[3]=t("div",{class:"text-center text-gray-500 text-sm"},[t("p",null,"目前仅支持谷歌账号登录"),t("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),w.value?(c(),d("div",G,[u(s,{type:"danger",size:"small",onClick:y},{default:f(()=>e[1]||(e[1]=[C(" 退出登录 ",-1)])),_:1,__:[1]})])):_("",!0)])])])}}});const J=N(V,[["__scopeId","data-v-290baa00"]]);export{J as default};

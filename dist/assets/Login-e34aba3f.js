import{d as v,H as u,l as b,I as S,o as j,s as l,r as g,b as c,c as r,f as o,i as d,h as f,k,aj as E,p as _,j as I,_ as C}from"./index-b25e871b.js";import{j as L}from"./index-bcdd064d.js";const N={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},O={class:"w-96"},T={class:"space-y-6"},z={key:0,class:"text-center"},B={key:1,class:"text-center"},G=v({__name:"Login",setup(V){const i=u(!1),p=u(!1),n=b(),m="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",w=S(()=>n.getLoginStatus);j(()=>{if(n.initUserState(),n.getLoginStatus){window.location.href="/userinfo";return}const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{p.value=!0,x()},document.head.appendChild(t)});const x=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:m,callback:y,auto_select:!1,cancel_on_tap_outside:!0});const t=document.getElementById("google-signin-button");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},y=async t=>{if(t.credential){i.value=!0;try{const e=await fetch("/google-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:t.credential})});if(!e.ok)throw new Error("认证请求失败");const s=await e.json();if(s.success){const a=L(s.token);console.log("jwt",a),l.success(`欢迎回来，${a.username}！`),localStorage.setItem("TOKEN",s.token),n.initUserState(),window.location.href="/userinfo"}else throw new Error(s.error||"认证失败")}catch(e){l.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{i.value=!1}}},h=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),n.logout(),l.success("已退出登录")};return(t,e)=>{const s=g("el-icon"),a=g("el-button");return c(),r("div",N,[o("div",O,[e[4]||(e[4]=o("div",{class:"text-center mb-8"},[o("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录"),o("p",{class:"text-gray-600"},"欢迎使用Tools-Web工具箱")],-1)),o("div",T,[e[2]||(e[2]=o("div",{class:"flex justify-center"},[o("div",{id:"google-signin-button"})],-1)),i.value?(c(),r("div",z,[d(s,{class:"is-loading"},{default:f(()=>[d(k(E))]),_:1}),e[0]||(e[0]=o("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):_("",!0),e[3]||(e[3]=o("div",{class:"text-center text-gray-500 text-sm"},[o("p",null,"目前仅支持谷歌账号登录"),o("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),w.value?(c(),r("div",B,[d(a,{type:"danger",size:"small",onClick:h},{default:f(()=>e[1]||(e[1]=[I(" 退出登录 ",-1)])),_:1,__:[1]})])):_("",!0)])])])}}});const D=C(G,[["__scopeId","data-v-29f17c8c"]]);export{D as default};

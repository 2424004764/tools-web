import{d as H,r as l,s as N,J as O,o as W,ac as h,y as r,f as y,g as a,h as i,j as s,t as B,m as n,l as f,q as p,an as w,v as _,p as T,_ as A}from"./index-dbd8ad74.js";import{j as M}from"./index-bcdd064d.js";const V={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},q={class:"w-96"},D={class:"text-center mb-8"},K={class:"text-gray-600"},J={class:"space-y-6"},X={class:"flex justify-center"},$=["disabled"],F={key:0,class:"text-sm font-medium text-gray-600"},P={key:1,class:"flex items-center"},Q={class:"flex justify-center"},R=["disabled"],Y={key:0,class:"text-sm font-medium text-gray-600"},Z={key:1,class:"flex items-center"},tt={class:"flex justify-center"},et=["disabled"],st={key:0,class:"text-sm font-medium text-gray-600"},ot={key:1,class:"flex items-center"},at={key:0,class:"text-center"},it={key:1,class:"text-center"},nt=H({__name:"Login",setup(rt){const v=l("一方工具箱"),m=l("https://tool.fologde.com"),x=l(!1),c=l(!1),u=l(!1),g=l(!1),L=l(!1),d=N(),k="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",G=O(()=>d.getLoginStatus);W(()=>{if(d.initUserState(),d.getLoginStatus){window.location.href="/userinfo";return}const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{L.value=!0,E()},document.head.appendChild(t),window.addEventListener("message",z)});const E=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:k,callback:j,auto_select:!1,cancel_on_tap_outside:!0});const t=document.getElementById("google-signin-button");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},j=async t=>{if(t.credential){x.value=!0;try{const e=await h.post("/google-auth",{credential:t.credential});if(e.data.success){const o=M(e.data.token);console.log("jwt",o),r.success(`欢迎回来，${o.username}！`),localStorage.setItem("TOKEN",e.data.token),d.initUserState(),window.location.href="/userinfo"}else throw new Error(e.data.error||"认证失败")}catch(e){r.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{x.value=!1}}},S=async()=>{try{c.value=!0;const t=await h.post(m.value+"/linuxdo-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("Linux.do登录配置错误");if(!window.open(t.data.auth_url,"linuxdo-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("Linux.do login error:",t),r.error("Linux.do登录失败，请重试"),c.value=!1}},C=async()=>{try{u.value=!0;const t=await h.post(m.value+"/gitee-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("Gitee登录配置错误");if(!window.open(t.data.auth_url,"gitee-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("Gitee login error:",t),r.error("Gitee登录失败，请重试"),u.value=!1}},I=async()=>{try{g.value=!0;const t=await h.post(m.value+"/github-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("GitHub登录配置错误");if(!window.open(t.data.auth_url,"github-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("GitHub login error:",t),r.error("GitHub登录失败，请重试"),g.value=!1}},z=t=>{var o;["https://connect.linux.do","https://gitee.com","https://github.com",m.value,window.location.origin].some(b=>t.origin.startsWith(b))&&(!t.data||typeof t.data!="object"||["success","error"].includes((o=t.data)==null?void 0:o.type)&&(t.data.type==="success"&&t.data.success?(localStorage.setItem("TOKEN",t.data.data.token),d.initUserState(),r.success(t.data.message||"登录成功"),window.location.href="/userinfo"):(t.data.type==="error"||!t.data.success)&&r.error(t.data.message||"登录失败，请重试"),c.value=!1,u.value=!1,g.value=!1))},U=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),d.logout(),r.success("已退出登录")};return(t,e)=>{const o=y("el-icon"),b=y("el-button");return a(),i("div",V,[s("div",q,[s("div",D,[e[0]||(e[0]=s("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录",-1)),s("p",K,"欢迎使用"+B(v.value),1)]),s("div",J,[e[9]||(e[9]=s("div",{class:"flex justify-center"},[s("div",{id:"google-signin-button"})],-1)),s("div",X,[s("button",{onClick:I,disabled:g.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[2]||(e[2]=s("img",{src:"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",alt:"GitHub",class:"h-5 w-auto mr-3"},null,-1)),g.value?(a(),i("div",P,[n(o,{class:"is-loading mr-2"},{default:f(()=>[n(p(w))]),_:1}),e[1]||(e[1]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),i("span",F," 使用 GitHub 登录 "))],8,$)]),s("div",Q,[s("button",{onClick:S,disabled:c.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[4]||(e[4]=s("img",{src:"https://linux.do/uploads/default/original/4X/c/c/d/ccd8c210609d498cbeb3d5201d4c259348447562.png",alt:"Linux.do",class:"w-5 h-5 mr-3"},null,-1)),c.value?(a(),i("div",Z,[n(o,{class:"is-loading mr-2"},{default:f(()=>[n(p(w))]),_:1}),e[3]||(e[3]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),i("span",Y," 使用 Linux.do 登录 "))],8,R)]),s("div",tt,[s("button",{onClick:C,disabled:u.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[6]||(e[6]=s("img",{src:"https://gitee.com/static/images/logo-black.svg?t=158106664",alt:"Gitee",class:"h-5 w-auto mr-3"},null,-1)),u.value?(a(),i("div",ot,[n(o,{class:"is-loading mr-2"},{default:f(()=>[n(p(w))]),_:1}),e[5]||(e[5]=s("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(a(),i("span",st," 使用 Gitee 登录 "))],8,et)]),e[10]||(e[10]=s("div",{class:"flex items-center"},[s("div",{class:"flex-1 border-t border-gray-200"}),s("span",{class:"px-3 text-sm text-gray-500"},"或"),s("div",{class:"flex-1 border-t border-gray-200"})],-1)),x.value?(a(),i("div",at,[n(o,{class:"is-loading"},{default:f(()=>[n(p(w))]),_:1}),e[7]||(e[7]=s("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):_("",!0),e[11]||(e[11]=s("div",{class:"text-center text-gray-500 text-sm"},[s("p",null,"支持谷歌账号、GitHub账号、Linux.do账号和Gitee账号登录"),s("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),G.value?(a(),i("div",it,[n(b,{type:"danger",size:"small",onClick:U},{default:f(()=>e[8]||(e[8]=[T(" 退出登录 ",-1)])),_:1,__:[8]})])):_("",!0)])])])}}});const ct=A(nt,[["__scopeId","data-v-85d50b51"]]);export{ct as default};

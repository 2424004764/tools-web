import{d as S,r as l,s as b,J as j,o as E,y as r,f as g,g as c,h as d,j as o,t as k,m as u,l as _,q as I,an as C,v as f,p as L,_ as N}from"./index-f8d05219.js";import{j as O}from"./index-bcdd064d.js";const T={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},z={class:"w-96"},B={class:"text-center mb-8"},G={class:"text-gray-600"},V={class:"space-y-6"},q={key:0,class:"text-center"},D={key:1,class:"text-center"},U=S({__name:"Login",setup(J){const p=l("一方工具箱"),i=l(!1),m=l(!1),n=b(),w="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",y=j(()=>n.getLoginStatus);E(()=>{if(n.initUserState(),n.getLoginStatus){window.location.href="/userinfo";return}const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{m.value=!0,x()},document.head.appendChild(t)});const x=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:w,callback:h,auto_select:!1,cancel_on_tap_outside:!0});const t=document.getElementById("google-signin-button");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},h=async t=>{if(t.credential){i.value=!0;try{const e=await fetch("/google-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:t.credential})});if(!e.ok)throw new Error("认证请求失败");const s=await e.json();if(s.success){const a=O(s.token);console.log("jwt",a),r.success(`欢迎回来，${a.username}！`),localStorage.setItem("TOKEN",s.token),n.initUserState(),window.location.href="/userinfo"}else throw new Error(s.error||"认证失败")}catch(e){r.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{i.value=!1}}},v=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),n.logout(),r.success("已退出登录")};return(t,e)=>{const s=g("el-icon"),a=g("el-button");return c(),d("div",T,[o("div",z,[o("div",B,[e[0]||(e[0]=o("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录",-1)),o("p",G,"欢迎使用"+k(p.value),1)]),o("div",V,[e[3]||(e[3]=o("div",{class:"flex justify-center"},[o("div",{id:"google-signin-button"})],-1)),i.value?(c(),d("div",q,[u(s,{class:"is-loading"},{default:_(()=>[u(I(C))]),_:1}),e[1]||(e[1]=o("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):f("",!0),e[4]||(e[4]=o("div",{class:"text-center text-gray-500 text-sm"},[o("p",null,"目前仅支持谷歌账号登录"),o("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),y.value?(c(),d("div",D,[u(a,{type:"danger",size:"small",onClick:v},{default:_(()=>e[2]||(e[2]=[L(" 退出登录 ",-1)])),_:1,__:[2]})])):f("",!0)])])])}}});const K=N(U,[["__scopeId","data-v-83801a40"]]);export{K as default};

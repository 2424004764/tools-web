import{d as X,o as A,l as S,A as b,m as J,r as Q,b as d,c as u,i as x,f as e,x as f,aa as I,a8 as j,t as n,j as z,F as P,e as M,C,D as H,k as K,h as y,af as Y,_ as Z}from"./index-d3de5c71.js";import{_ as ee}from"./DetailHeader.vue_vue_type_script_setup_true_lang-4cf6bf85.js";import{_ as k}from"./ToolDetail.vue_vue_type_script_setup_true_lang-522d2189.js";const te={class:"flex flex-col mt-3 flex-1"},se={class:"p-4 rounded-2xl bg-white"},le={class:"mb-6"},oe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ne={class:"flex items-center col-span-full"},ae={class:"flex items-center space-x-2"},ie={class:"text-sm text-gray-600 w-12"},re={class:"space-y-2"},de={class:"flex justify-between text-xs text-gray-500"},ue={class:"text-xs text-gray-600"},ce={class:"flex items-center"},me={class:"flex items-center"},pe={key:0,class:"mb-6 p-4 bg-gray-100 rounded-lg"},ge={class:"text-xs text-gray-600 max-h-32 overflow-y-auto"},xe={class:"mb-6"},ve={key:1,class:"mb-6"},be={class:"flex justify-between items-center mb-4"},fe={class:"text-lg font-semibold"},ye=["disabled"],_e={key:0},he={key:1,class:"flex items-center"},we={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ce={class:"flex items-center justify-between mb-2"},ke={class:"text-sm font-medium text-gray-700 truncate"},Ie=["onClick"],ze={class:"text-xs text-gray-500 mb-2"},Pe={class:"text-xs text-gray-500 mb-2"},Me={class:"text-xs text-blue-600 bg-blue-50 p-2 rounded"},Fe={key:2,class:"mb-6"},Ee={class:"flex justify-between items-center mb-4"},$e={class:"text-lg font-semibold"},Se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},je={class:"mb-3"},De=["src","alt"],We={class:"space-y-2 text-sm"},Ue={class:"flex justify-between"},Be={class:"font-medium"},Le={class:"flex justify-between"},Re={class:"font-medium"},Ge={class:"flex justify-between"},Te={class:"font-medium text-green-600"},Ve={key:0,class:"text-xs text-gray-500 border-t pt-2 mt-2"},Ne=["onClick"],Oe=X({__name:"ImageCompress",setup(qe){let v=null;const D=async()=>{try{const s=await Y(()=>import("./compressor.esm-099282e0.js"),[]);v=s.default||s,console.log("Compressor.js 加载成功:",v)}catch(s){console.error("Compressor.js 加载失败:",s),alert("图片压缩库加载失败，请刷新页面重试")}};A(()=>{D()});const o=S({quality:.6,convertSize:1e6,convertToWebP:!1,retainExif:!1,smartCompression:!0}),_=b(!1),h=b(!1),p=b([]),c=b([]),w=b([]),F=s=>{if(!s)return;const t=Array.from(s).filter(a=>a.type.startsWith("image/"));if(t.length===0){alert("请选择图片文件");return}p.value=[...p.value,...t],m(`添加了 ${t.length} 张图片`)},W=s=>{var a;s.preventDefault(),_.value=!1;const t=(a=s.dataTransfer)==null?void 0:a.files;t&&F(t)},U=s=>{s.preventDefault(),_.value=!0},B=s=>{s.preventDefault(),_.value=!1},m=s=>{const t=new Date().toLocaleTimeString();w.value.push(`[${t}] ${s}`),console.log(s)},L=async()=>{if(p.value.length!==0){if(!v){alert("图片压缩库未加载，请刷新页面重试");return}h.value=!0,c.value=[],m("开始压缩图片...");try{for(const s of p.value)await R(s)}catch(s){console.error("压缩失败:",s),m(`压缩失败: ${s}`),alert("压缩过程中出现错误，请重试")}finally{h.value=!1,m("压缩完成")}}},R=s=>new Promise((t,a)=>{m(`开始压缩: ${s.name} (${g(s.size)})`);const l=new Image;l.onload=()=>{m(`原图尺寸: ${l.width}×${l.height}`);let i=o.quality;if(o.smartCompression){const r=s.size/1048576;r>5?i=Math.min(i,.5):r>2&&(i=Math.min(i,.6)),m(`调整后质量: ${Math.round(i*100)}%`)}m(`压缩参数: 质量=${Math.round(i*100)}%, 保持原尺寸`),new v(s,{quality:i,convertSize:o.convertSize,convertToWebP:o.convertToWebP,retainExif:o.retainExif,success:r=>{const $=(s.size-r.size)/s.size*100;m(`压缩完成: ${s.name} -> ${g(r.size)} (压缩率: ${$.toFixed(1)}%)`);const q={id:Date.now().toString()+Math.random(),originalFile:s,compressedFile:r,originalSize:s.size,compressedSize:r.size,compressionRatio:$,url:URL.createObjectURL(r),actualQuality:i,actualMaxWidth:l.width,actualMaxHeight:l.height};c.value.push(q),t()},error:r=>{m(`压缩失败: ${s.name} - ${r.message||r}`),console.error("压缩失败:",r),a(r)}})},l.onerror=()=>{m(`无法读取图片: ${s.name}`),a(new Error("无法读取图片"))},l.src=URL.createObjectURL(s)}),G=S({title:"图片压缩"}),E=s=>{const t=document.createElement("a");t.href=s.url,t.download=`compressed_${s.originalFile.name}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},T=()=>{c.value.forEach(s=>{E(s)})},V=()=>{p.value=[],c.value.forEach(s=>{URL.revokeObjectURL(s.url)}),c.value=[],w.value=[]},N=s=>{const t=p.value[s];p.value.splice(s,1);const a=c.value.findIndex(l=>l.originalFile===t);if(a!==-1){const l=c.value[a];URL.revokeObjectURL(l.url),c.value.splice(a,1)}},g=s=>{if(s===0)return"0 B";const t=1024,a=["B","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,l)).toFixed(2))+" "+a[l]},O=s=>{const t=s.size/1048576;return t>5?"建议：大文件推荐质量0.5以下，最大尺寸1200×800":t>2?"建议：中等文件推荐质量0.6以下，最大尺寸1200×800":t>1?"建议：小文件推荐质量0.7以下，最大尺寸1200×800":"建议：小文件可以保持较高质量，但建议关闭EXIF保留"};return J(()=>{c.value.forEach(s=>{URL.revokeObjectURL(s.url)})}),(s,t)=>{const a=Q("el-text");return d(),u("div",te,[x(ee,{title:G.title},null,8,["title"]),e("div",se,[e("div",le,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold mb-4"},"压缩设置",-1)),e("div",oe,[e("div",ne,[f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>o.smartCompression=l),type:"checkbox",id:"smartCompression",class:"mr-2"},null,512),[[I,o.smartCompression]]),t[6]||(t[6]=e("label",{for:"smartCompression",class:"text-sm font-medium text-gray-700"}," 智能压缩（根据文件大小自动优化质量参数） ",-1))]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"压缩质量",-1)),e("div",ae,[f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o.quality=l),type:"range",min:"0.1",max:"1",step:"0.1",class:"flex-1"},null,512),[[j,o.quality]]),e("span",ie,n(Math.round(o.quality*100))+"%",1)]),t[8]||(t[8]=e("p",{class:"text-xs text-gray-600 mt-1"}," 图片将保持原始尺寸，仅调整压缩质量 ",-1))]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[z(" 转换阈值 "),e("span",{class:"text-xs text-gray-500 ml-1"},"(超过此大小的图片自动转换为WebP格式)")],-1)),e("div",re,[f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.convertSize=l),type:"range",min:"100000",max:"10000000",step:"100000",class:"w-full"},null,512),[[j,o.convertSize]]),e("div",de,[t[9]||(t[9]=e("span",null,"100KB",-1)),e("span",null,n(g(o.convertSize)),1),t[10]||(t[10]=e("span",null,"10MB",-1))]),e("p",ue," 当前设置：当图片超过 "+n(g(o.convertSize))+" 时，自动转换为WebP格式以获得更好的压缩效果 ",1)])]),e("div",ce,[f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.convertToWebP=l),type:"checkbox",id:"convertToWebP",class:"mr-2"},null,512),[[I,o.convertToWebP]]),t[12]||(t[12]=e("label",{for:"convertToWebP",class:"text-sm font-medium text-gray-700"},"转换为WebP格式",-1))]),e("div",me,[f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.retainExif=l),type:"checkbox",id:"retainExif",class:"mr-2"},null,512),[[I,o.retainExif]]),t[13]||(t[13]=e("label",{for:"retainExif",class:"text-sm font-medium text-gray-700"},"保留EXIF信息",-1))])])]),w.value.length>0?(d(),u("div",pe,[t[15]||(t[15]=e("h4",{class:"font-medium mb-2"},"调试信息:",-1)),e("div",ge,[(d(!0),u(P,null,M(w.value,(l,i)=>(d(),u("div",{key:i,class:"mb-1"},n(l),1))),128))])])):C("",!0),e("div",xe,[e("div",{onDrop:W,onDragover:U,onDragleave:B,class:H(["border-2 border-dashed rounded-lg p-8 text-center transition-colors",_.value?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[t[16]||(t[16]=e("div",{class:"text-4xl mb-4"},"️",-1)),t[17]||(t[17]=e("p",{class:"text-lg font-medium text-gray-700 mb-2"},"拖拽图片到此处或点击选择",-1)),t[18]||(t[18]=e("p",{class:"text-sm text-gray-500 mb-4"},"支持 JPG、PNG、WebP、GIF 等格式",-1)),e("input",{type:"file",multiple:"",accept:"image/*",onChange:t[5]||(t[5]=l=>F(l.target.files)),class:"hidden",id:"fileInput"},null,32),t[19]||(t[19]=e("label",{for:"fileInput",class:"inline-block px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 cursor-pointer transition-colors"}," 选择图片 ",-1))],34)]),p.value.length>0?(d(),u("div",ve,[e("div",be,[e("h3",fe,"待压缩图片 ("+n(p.value.length)+")",1),e("button",{onClick:L,disabled:h.value||!K(v),class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[h.value?(d(),u("span",he,t[20]||(t[20]=[e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),z(" 压缩中... ",-1)]))):(d(),u("span",_e,"开始压缩"))],8,ye)]),e("div",we,[(d(!0),u(P,null,M(p.value,(l,i)=>(d(),u("div",{key:i,class:"border rounded-lg p-4 relative"},[e("div",Ce,[e("span",ke,n(l.name),1),e("button",{onClick:r=>N(i),class:"text-red-500 hover:text-red-700 text-lg"}," × ",8,Ie)]),e("div",ze,n(g(l.size)),1),e("div",Pe,n(l.type),1),e("div",Me,n(O(l)),1)]))),128))])])):C("",!0),c.value.length>0?(d(),u("div",Fe,[e("div",Ee,[e("h3",$e,"压缩结果 ("+n(c.value.length)+")",1),e("button",{onClick:T,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"}," 批量下载 ")]),e("div",Se,[(d(!0),u(P,null,M(c.value,l=>(d(),u("div",{key:l.id,class:"border rounded-lg p-4"},[e("div",je,[e("img",{src:l.url,alt:l.originalFile.name,class:"w-full h-32 object-cover rounded border"},null,8,De)]),e("div",We,[e("div",Ue,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"原始大小:",-1)),e("span",Be,n(g(l.originalSize)),1)]),e("div",Le,[t[22]||(t[22]=e("span",{class:"text-gray-600"},"压缩后:",-1)),e("span",Re,n(g(l.compressedSize)),1)]),e("div",Ge,[t[23]||(t[23]=e("span",{class:"text-gray-600"},"压缩率:",-1)),e("span",Te,n(l.compressionRatio.toFixed(1))+"%",1)])]),l.actualQuality?(d(),u("div",Ve,[e("div",null,"实际质量: "+n(Math.round(l.actualQuality*100))+"%",1),e("div",null,"图片尺寸: "+n(l.actualMaxWidth)+"×"+n(l.actualMaxHeight),1)])):C("",!0),e("button",{onClick:i=>E(l),class:"w-full mt-3 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"}," 下载 ",8,Ne)]))),128))])])):C("",!0),e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:V,class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"}," 清空所有 ")])]),x(k,{title:"描述"},{default:y(()=>[x(a,null,{default:y(()=>t[24]||(t[24]=[z(" 图片压缩工具使用先进的Compressor.js库，支持多种图片格式的在线压缩。 可以调节压缩质量、最大尺寸等参数，在保持图片质量的同时有效减小文件大小。 支持批量处理，适合网站优化、邮件发送等场景。 ",-1)])),_:1,__:[24]})]),_:1}),x(k,{title:"功能特点"},{default:y(()=>t[25]||(t[25]=[e("ul",{class:"list-disc list-inside space-y-2 text-gray-700"},[e("li",null,"支持多种格式：JPG、PNG、WebP、GIF等"),e("li",null,"可调节压缩质量：0.1-1.0，平衡文件大小和质量"),e("li",null,"智能转换：大文件自动转换为WebP格式"),e("li",null,"保留EXIF：可选择保留图片的元数据信息"),e("li",null,"批量处理：支持多张图片同时压缩"),e("li",null,"实时预览：压缩前后对比，显示压缩率"),e("li",null,"拖拽上传：支持拖拽文件到页面"),e("li",null,"保持原尺寸：图片压缩后保持原始宽度和高度")],-1)])),_:1,__:[25]}),x(k,{title:"使用说明"},{default:y(()=>t[26]||(t[26]=[e("ol",{class:"list-decimal list-inside space-y-2 text-gray-700"},[e("li",null,"调整压缩参数：设置质量、尺寸等参数"),e("li",null,"上传图片：拖拽或点击选择图片文件"),e("li",null,'开始压缩：点击"开始压缩"按钮'),e("li",null,"查看结果：对比压缩前后的文件大小和压缩率"),e("li",null,"下载图片：单张下载或批量下载压缩后的图片")],-1)])),_:1,__:[26]}),x(k,{title:"为什么有的图片越压缩越大？"},{default:y(()=>t[27]||(t[27]=[e("div",{class:"space-y-3 text-gray-700"},[e("p",{class:"text-sm leading-relaxed"}," 图片压缩后文件变大是一个常见现象，主要原因如下： "),e("div",{class:"space-y-2"},[e("h4",{class:"font-medium text-gray-800"},"1. 压缩质量设置过高"),e("p",{class:"text-sm text-gray-600 pl-4"}," 如果压缩质量设置为1.0（100%），实际上没有进行任何压缩，反而可能因为格式转换导致文件变大。 "),e("h4",{class:"font-medium text-gray-800"},"2. 尺寸限制设置不当"),e("p",{class:"text-sm text-gray-600 pl-4"}," 如果设置的最大宽度/高度比原图尺寸还大，图片不会被缩小，反而可能因为重新编码而增大。 "),e("h4",{class:"font-medium text-gray-800"},"3. 格式转换问题"),e("p",{class:"text-sm text-gray-600 pl-4"}," 某些格式转换（如PNG转JPG）可能会增加文件大小，特别是当原图包含大量透明区域或简单图形时。 "),e("h4",{class:"font-medium text-gray-800"},"4. EXIF信息保留"),e("p",{class:"text-sm text-gray-600 pl-4"}," 保留EXIF信息（相机参数、GPS位置等）会增加文件大小，建议关闭此选项以获得更好的压缩效果。 "),e("h4",{class:"font-medium text-gray-800"},"5. 原图已经高度压缩"),e("p",{class:"text-sm text-gray-600 pl-4"}," 如果原图已经是高度压缩的格式（如低质量JPG），再次压缩可能无法获得更好的效果。 ")]),e("div",{class:"bg-blue-50 p-3 rounded-lg"},[e("h4",{class:"font-medium text-blue-800 mb-2"},"💡 压缩建议"),e("ul",{class:"text-sm text-blue-700 space-y-1"},[e("li",null,"• 大文件（>5MB）：质量0.5以下，最大尺寸1200×800"),e("li",null,"• 中等文件（2-5MB）：质量0.6以下，最大尺寸1200×800"),e("li",null,"• 小文件（<2MB）：质量0.7以下，关闭EXIF保留"),e("li",null,'• 开启"智能压缩"选项，让工具自动优化参数'),e("li",null,"• 对于PNG图片，考虑转换为WebP格式以获得更好的压缩效果")])]),e("div",{class:"bg-yellow-50 p-3 rounded-lg"},[e("h4",{class:"font-medium text-yellow-800 mb-2"},"⚠️ 注意事项"),e("ul",{class:"text-sm text-yellow-700 space-y-1"},[e("li",null,"• 压缩质量越低，文件越小，但图片质量也越差"),e("li",null,"• 尺寸压缩会改变图片分辨率，影响显示效果"),e("li",null,"• 某些特殊格式的图片可能不适合压缩"),e("li",null,"• 建议先压缩少量图片测试效果，再批量处理")])])],-1)])),_:1,__:[27]})])}}});const Qe=Z(Oe,[["__scopeId","data-v-3641b6c3"]]);export{Qe as default};

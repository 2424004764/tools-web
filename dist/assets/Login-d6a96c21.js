import{d as N,r,s as z,J as T,o as U,ac as m,y as i,f as p,g as d,h as c,j as o,t as B,m as u,l as f,q as x,an as _,v as w,p as G,_ as O}from"./index-3b1783ed.js";import{j as V}from"./index-bcdd064d.js";const q={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},D={class:"w-96"},M={class:"text-center mb-8"},A={class:"text-gray-600"},K={class:"space-y-6"},W={class:"flex justify-center"},$=["disabled"],J={key:0,class:"text-sm font-medium text-gray-600"},X={key:1,class:"flex items-center"},F={key:0,class:"text-center"},H={key:1,class:"text-center"},P=N({__name:"Login",setup(Q){const y=r("一方工具箱"),h=r("https://tool.fologde.com"),g=r(!1),n=r(!1),v=r(!1),a=z(),b="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",L=T(()=>a.getLoginStatus);U(()=>{if(a.initUserState(),a.getLoginStatus){window.location.href="/userinfo";return}const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{v.value=!0,S()},document.head.appendChild(t),window.addEventListener("message",j)});const S=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:b,callback:E,auto_select:!1,cancel_on_tap_outside:!0});const t=document.getElementById("google-signin-button");t&&window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},E=async t=>{if(t.credential){g.value=!0;try{const e=await m.post("/google-auth",{credential:t.credential});if(e.data.success){const s=V(e.data.token);console.log("jwt",s),i.success(`欢迎回来，${s.username}！`),localStorage.setItem("TOKEN",e.data.token),a.initUserState(),window.location.href="/userinfo"}else throw new Error(e.data.error||"认证失败")}catch(e){i.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{g.value=!1}}},k=async()=>{try{n.value=!0;const t=await m.post(h.value+"/linuxdo-auth",{params:{action:"getAuthUrl"}});if(!t.data.success)throw new Error("Linux.do登录配置错误");if(!window.open(t.data.auth_url,"linuxdo-auth","width=600,height=600,scrollbars=yes,resizable=yes"))throw new Error("无法打开登录窗口，请检查浏览器弹窗设置")}catch(t){console.error("Linux.do login error:",t),i.error("Linux.do登录失败，请重试"),n.value=!1}},j=t=>{var e;if(((e=t.data)==null?void 0:e.type)==="success"){n.value=!1;const{token:s,user:l,message:C}=t.data.data;i.success(C||`欢迎回来，${l.username}！`),localStorage.setItem("TOKEN",s),a.initUserState(),setTimeout(()=>{window.location.href="/userinfo"},1e3)}else{n.value=!1;const{error:s,message:l}=t.data;console.error("Linux.do auth error:",s,l),i.error(l||"Linux.do登录失败，请重试")}},I=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),a.logout(),i.success("已退出登录")};return(t,e)=>{const s=p("el-icon"),l=p("el-button");return d(),c("div",q,[o("div",D,[o("div",M,[e[0]||(e[0]=o("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录",-1)),o("p",A,"欢迎使用"+B(y.value),1)]),o("div",K,[e[5]||(e[5]=o("div",{class:"flex justify-center"},[o("div",{id:"google-signin-button"})],-1)),o("div",W,[o("button",{onClick:k,disabled:n.value,class:"flex items-center justify-center w-full max-w-[400px] h-[40px] border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[e[2]||(e[2]=o("img",{src:"https://linux.do/uploads/default/original/4X/c/c/d/ccd8c210609d498cbeb3d5201d4c259348447562.png",alt:"Linux.do",class:"w-5 h-5 mr-3"},null,-1)),n.value?(d(),c("div",X,[u(s,{class:"is-loading mr-2"},{default:f(()=>[u(x(_))]),_:1}),e[1]||(e[1]=o("span",{class:"text-sm text-gray-600"},"登录中...",-1))])):(d(),c("span",J," 使用 Linux.do 登录 "))],8,$)]),e[6]||(e[6]=o("div",{class:"flex items-center"},[o("div",{class:"flex-1 border-t border-gray-200"}),o("span",{class:"px-3 text-sm text-gray-500"},"或"),o("div",{class:"flex-1 border-t border-gray-200"})],-1)),g.value?(d(),c("div",F,[u(s,{class:"is-loading"},{default:f(()=>[u(x(_))]),_:1}),e[3]||(e[3]=o("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):w("",!0),e[7]||(e[7]=o("div",{class:"text-center text-gray-500 text-sm"},[o("p",null,"支持谷歌账号和Linux.do账号登录"),o("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),L.value?(d(),c("div",H,[u(l,{type:"danger",size:"small",onClick:I},{default:f(()=>e[4]||(e[4]=[G(" 退出登录 ",-1)])),_:1,__:[4]})])):w("",!0)])])])}}});const Z=O(P,[["__scopeId","data-v-4a063c9e"]]);export{Z as default};

import{d as h,A as i,B as b,o as I,E as c,r as g,b as r,c as d,f as t,i as u,h as m,k as E,ac as S,C as _,j,_ as k}from"./index-12b54200.js";import{j as C}from"./index-bcdd064d.js";const N={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},O={class:"w-96"},B={class:"space-y-6"},L={key:0,class:"text-center"},T={key:1,class:"text-center"},z=h({__name:"Login",setup(G){const a=i(!1),f=i(!1),l=i(null),p="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",v=b(()=>!!l.value);I(()=>{const o=localStorage.getItem("user");if(o)try{l.value=JSON.parse(o)}catch{localStorage.removeItem("user")}const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{f.value=!0,w()},document.head.appendChild(e)});const w=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:p,callback:y,auto_select:!1,cancel_on_tap_outside:!0});const o=document.getElementById("google-signin-button");o&&window.google.accounts.id.renderButton(o,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},y=async o=>{if(o.credential){a.value=!0;try{const e=await fetch("/google-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:o.credential})});if(!e.ok)throw new Error("认证请求失败");const s=await e.json();if(s.success){const n=C(s.token);console.log("jwt",n),c.success(`欢迎回来，${n.username}！`),localStorage.setItem("TOKEN",s.token)}else throw new Error(s.error||"认证失败")}catch(e){c.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{a.value=!1}}},x=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),l.value=null,localStorage.removeItem("user"),c.success("已退出登录")};return(o,e)=>{const s=g("el-icon"),n=g("el-button");return r(),d("div",N,[t("div",O,[e[4]||(e[4]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录"),t("p",{class:"text-gray-600"},"欢迎使用Tools-Web工具箱")],-1)),t("div",B,[e[2]||(e[2]=t("div",{class:"flex justify-center"},[t("div",{id:"google-signin-button"})],-1)),a.value?(r(),d("div",L,[u(s,{class:"is-loading"},{default:m(()=>[u(E(S))]),_:1}),e[0]||(e[0]=t("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):_("",!0),e[3]||(e[3]=t("div",{class:"text-center text-gray-500 text-sm"},[t("p",null,"目前仅支持谷歌账号登录"),t("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),v.value?(r(),d("div",T,[u(n,{type:"danger",size:"small",onClick:x},{default:m(()=>e[1]||(e[1]=[j(" 退出登录 ",-1)])),_:1,__:[1]})])):_("",!0)])])])}}});const A=k(z,[["__scopeId","data-v-4056369d"]]);export{A as default};

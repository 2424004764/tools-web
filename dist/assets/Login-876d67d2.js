import{d as h,A as l,B as b,o as I,E as i,r as u,b as r,c,f as t,i as d,h as g,k as S,ac as E,C as f,j as C,_ as k}from"./index-36cb1829.js";const N={class:"flex flex-col mt-8 flex-1 items-center bg-white rounded-md p-10"},O={class:"w-96"},j={class:"space-y-6"},B={key:0,class:"text-center"},L={key:1,class:"text-center"},z=h({__name:"Login",setup(G){const a=l(!1),_=l(!1),n=l(null),m="825228691844-jflrvsfqa82gs1s225qbcaa4raujmp1f.apps.googleusercontent.com",p=b(()=>!!n.value);I(()=>{const o=localStorage.getItem("user");if(o)try{n.value=JSON.parse(o)}catch{localStorage.removeItem("user")}const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{_.value=!0,v()},document.head.appendChild(e)});const v=()=>{if(typeof window.google<"u"){window.google.accounts.id.initialize({client_id:m,callback:y,auto_select:!1,cancel_on_tap_outside:!0});const o=document.getElementById("google-signin-button");o&&window.google.accounts.id.renderButton(o,{theme:"outline",size:"large",type:"standard",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400})}},y=async o=>{if(o.credential){a.value=!0;try{const e=await fetch("/google-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:o.credential})});if(!e.ok)throw new Error("认证请求失败");const s=await e.json();if(s.success)i.success(`欢迎回来，${s.user.name}！`),n.value=s.user,localStorage.setItem("user",JSON.stringify(s.user));else throw new Error(s.error||"认证失败")}catch(e){i.error("谷歌登录失败，请重试"),console.error("Google sign-in error:",e)}finally{a.value=!1}}},x=()=>{typeof window.google<"u"&&window.google.accounts.id.disableAutoSelect(),n.value=null,localStorage.removeItem("user"),i.success("已退出登录")};return(o,e)=>{const s=u("el-icon"),w=u("el-button");return r(),c("div",N,[t("div",O,[e[4]||(e[4]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"用户登录"),t("p",{class:"text-gray-600"},"欢迎使用Tools-Web工具箱")],-1)),t("div",j,[e[2]||(e[2]=t("div",{class:"flex justify-center"},[t("div",{id:"google-signin-button"})],-1)),a.value?(r(),c("div",B,[d(s,{class:"is-loading"},{default:g(()=>[d(S(E))]),_:1}),e[0]||(e[0]=t("span",{class:"ml-2 text-gray-600"},"登录中...",-1))])):f("",!0),e[3]||(e[3]=t("div",{class:"text-center text-gray-500 text-sm"},[t("p",null,"目前仅支持谷歌账号登录"),t("p",{class:"mt-2"},"登录后可以享受更多个性化功能")],-1)),p.value?(r(),c("div",L,[d(w,{type:"danger",size:"small",onClick:x},{default:g(()=>e[1]||(e[1]=[C(" 退出登录 ",-1)])),_:1,__:[1]})])):f("",!0)])])])}}});const V=k(z,[["__scopeId","data-v-fac22140"]]);export{V as default};

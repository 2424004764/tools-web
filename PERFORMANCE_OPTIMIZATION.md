# 性能优化说明

## 问题描述
工具站进入某些功能时加载很慢，有时候甚至进不去，主要影响以下功能：
- 在线编辑图片（使用 tui-image-editor，约2MB）
- 3D数学方程式（使用 three.js，约600KB）
- PDF相关功能（使用 pdfjs-dist，约3MB）

## 优化方案

### 1. 路由加载进度条
**文件**: `src/router/index.ts`, `src/styles/loading.css`

添加了顶部加载进度条，让用户知道页面正在加载：
- 延迟200ms显示，避免快速切换时闪烁
- 使用CSS动画实现流畅的进度条效果
- 在路由切换完成后自动隐藏

### 2. AI初始化延迟加载
**文件**: `src/main.ts`

将AI提供者初始化从同步改为异步：
```javascript
// 延迟1秒初始化，不阻塞应用启动
setTimeout(() => {
  initializeAIProviders()
}, 1000)
```

### 3. 大型库按需加载
**文件**: `vite.config.ts`

移除了大型库的预打包配置，让它们按需加载：
- `tui-image-editor` - 仅在图片编辑页面加载
- `pdfjs-dist` - 仅在PDF功能页面加载
- `three.js` - 仅在3D数学方程式页面加载

这样可以显著减少首次加载时间和初始包体积。

### 4. 路由预加载优化
**文件**: `src/router/index.ts`

保留了现有的智能预加载机制：
- 空闲时预加载常用路由
- 访问某个路由时预加载相邻路由
- 避免重复预加载

## 效果预期

1. **首次加载更快**：应用启动时不再加载大型库
2. **视觉反馈更好**：顶部进度条让用户知道正在加载
3. **按需加载**：只有访问特定功能时才加载对应的大型库
4. **更流畅的体验**：AI初始化不再阻塞应用启动

## 测试建议

1. 清除浏览器缓存后测试首次加载速度
2. 测试进入图片编辑、PDF处理、3D数学方程式等功能的加载时间
3. 观察顶部进度条是否正常显示
4. 检查网络面板，确认大型库只在需要时才加载

## 进一步优化建议

如果仍然觉得慢，可以考虑：

1. **添加骨架屏**：在组件加载时显示占位内容
2. **Service Worker缓存**：缓存大型库文件
3. **CDN加速**：将大型库改用CDN链接
4. **懒加载图片**：使用图片懒加载减少初始加载
5. **代码分割优化**：进一步细化代码分割策略
